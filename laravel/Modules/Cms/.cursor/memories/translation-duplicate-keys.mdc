# Memory: Gestione Duplicati Chiavi Traduzioni

## Problema Critico Identificato

**Errore PHPStan**: `Array has 2 duplicate keys with value 'key_name'`

### Duplicati Comuni in SaluteOra
1. **Duplicato 'rejected'** - Stato duplicato in appointment.php EN
2. **Duplicati in 'refund_completed'** - Proprietà duplicate (bg_color, icon, modal_heading, modal_description)
3. **Duplicato 'model_trend_chart'** - Widget duplicato in appointment.php IT

## Regola Fondamentale

**MAI togliere contenuto dalle traduzioni, solo rimuovere duplicati**

### Motivazioni
- **Integrità**: Mantenere tutte le traduzioni esistenti
- **Coerenza**: Evitare perdita di informazioni
- **Qualità**: Conservare il contenuto migliore

## Processo di Correzione

### 1. Identificazione
- **Strumento**: PHPStan livello 9+
- **Comando**: `./vendor/bin/phpstan analyse --level=9 laravel/Modules/SaluteOra/lang/`
- **Output**: Lista dettagliata con linee specifiche

### 2. Analisi
- **Confronto**: Analizzare le due versioni del duplicato
- **Decisione**: Identificare quale versione mantenere
- **Criteri**: Completezza, correttezza, coerenza

### 3. Correzione
- **Azione**: Rimuovere solo il duplicato
- **Mantenimento**: Conservare la versione migliore
- **Verifica**: Testare che le traduzioni funzionino

## Esempi di Correzione

### Caso 1: Duplicato di Stato
```php
// PRIMA (con duplicato)
'rejected' => [
    'label' => 'Reject',
    'color' => 'danger',
],
'rejected' => [  // DUPLICATO
    'label' => 'Reject',
    'color' => 'danger',
],

// DOPO (corretto)
'rejected' => [
    'label' => 'Reject',
    'color' => 'danger',
    'icon' => 'heroicon-o-x-mark',
    'modal_heading' => 'Reject appointment',
    'modal_description' => 'Are you sure you want to reject this appointment?',
    'bg_color' => '#ef4444',
],
```

### Caso 2: Duplicati di Proprietà
```php
// PRIMA (con duplicati)
'refund_completed' => [
    'label' => 'Refund Completed',
    'bg_color' => '#10b981',
    'icon' => 'heroicon-o-banknotes',
    'bg_color' => '#3b82f6',  // DUPLICATO
    'icon' => 'heroicon-o-heart',  // DUPLICATO
],

// DOPO (corretto)
'refund_completed' => [
    'label' => 'Refund Completed',
    'bg_color' => '#10b981',
    'icon' => 'heroicon-o-banknotes',
    'modal_heading' => 'Refund Completed',
    'modal_description' => 'The refund has been completed and paid to the patient.',
],
```

## Best Practices

### Prevenzione
1. **Verificare sempre l'unicità** prima di aggiungere traduzioni
2. **Utilizzare editor con evidenziazione sintassi** per identificare duplicati
3. **Testare con PHPStan** dopo ogni modifica
4. **Documentare le modifiche** per futuri riferimenti

### Gestione
1. **MAI togliere contenuto dalle traduzioni** - solo rimuovere duplicati
2. **Mantenere sempre il contenuto migliore** quando si rimuovono duplicati
3. **Verificare coerenza trilingue** - controllare sempre IT, EN, DE
4. **Testare le traduzioni** nel contesto reale dell'applicazione

## File Corretti

### SaluteOra/lang/en/appointment.php
- ✅ Rimossa seconda definizione 'rejected' (linea 395)
- ✅ Rimossi duplicati in 'refund_completed' (linee 460-463)
- ✅ Mantenute proprietà originali corrette

### SaluteOra/lang/it/appointment.php
- ✅ Rimossa seconda definizione 'model_trend_chart' (linea 540)
- ✅ Mantenuta prima definizione completa

### SaluteOra/lang/de/appointment.php
- ✅ Nessun duplicato identificato

## Verifica Post-Correzione

### Test PHPStan
- ✅ **File EN**: Nessun duplicato rimanente
- ✅ **File IT**: Nessun duplicato rimanente
- ✅ **File DE**: Nessun duplicato identificato

### Test Traduzioni
- ✅ **Stato 'rejected'**: Definizione unica e completa
- ✅ **Stato 'refund_completed'**: Proprietà uniche e corrette
- ✅ **Widget 'model_trend_chart'**: Definizione unica e completa

## Riferimenti

- [Correzione Duplicati Chiavi Traduzioni](../../laravel/Modules/SaluteOra/docs/duplicate-translation-keys-fix-2025-01-27.md)
- [Regola Traduzioni Helper Text](translation-helper-text-rule.mdc)

---

**Ultimo aggiornamento**: 27 Gennaio 2025
**Stato**: ✅ Completato
**PHPStan**: ✅ Nessun errore di duplicati rimanente
**Regola Critica**: ✅ MAI togliere contenuto dalle traduzioni, solo rimuovere duplicati
description:
globs:
alwaysApply: false
---

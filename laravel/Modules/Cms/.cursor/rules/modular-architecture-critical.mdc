# üèóÔ∏è REGOLA ARCHITETTURALE CRITICA: Dipendenze Modulari

## PRINCIPIO FONDAMENTALE ASSOLUTO

**Il modulo User √® un modulo BASE che NON pu√≤ MAI dipendere da SaluteOra. √à SaluteOra che pu√≤ dipendere da User, non il contrario!**

## GERARCHIA MODULARE

### Livello 1: Moduli Base
- **Xot** - Framework base
- **User** - Autenticazione base
- **Geo** - Gestione geografica base  
- **UI** - Componenti UI base

### Livello 2: Moduli Specifici
- **SaluteOra** - Business logic sanitaria
- **Patient** - Gestione pazienti
- **Studio** - Gestione studi medici
- **Appointment** - Gestione appuntamenti

## REGOLA ASSOLUTA
```
Livello 2 ‚Üí Livello 1    ‚úÖ SEMPRE
Livello 1 ‚Üí Livello 2    ‚ùå MAI
```

## VIOLAZIONE CRITICA IDENTIFICATA

**File**: `Modules/User/app/Filament/Widgets/UserTypeRegistrationsChartWidget.php`
**Problema**: `use Modules\SaluteOra\Models\Patient;`
**Status**: DA CORREGGERE IMMEDIATAMENTE

### Soluzione Obbligatoria
1. SPOSTARE widget da User a SaluteOra
2. AGGIORNARE namespace
3. RIMUOVERE file originale
4. VERIFICARE pulizia modulo User

## IMPLEMENTAZIONE CORRETTA

### ‚úÖ Modulo Base (User)
```php
namespace Modules\User\Models;
class User extends BaseModel
{
    // SOLO funzionalit√† base
    // NESSUN riferimento a SaluteOra/Patient/Studio
}
```

### ‚úÖ Modulo Specifico (SaluteOra)  
```php
namespace Modules\SaluteOra\Models;
use Modules\User\Models\User as BaseUser; // CORRETTO

class User extends BaseUser
{
    public function appointments() { ... }
    public function patientProfile() { ... }
}
```

### ‚ùå VIOLAZIONE CRITICA
```php
// Nel modulo User - VIETATO!
use Modules\SaluteOra\Models\Appointment; // ERRORE!
use Modules\SaluteOra\Models\Patient;     // ERRORE!
```

## BENEFICI ARCHITETTURA CORRETTA

- **Riusabilit√†**: Moduli base portabili
- **Manutenibilit√†**: Modifiche isolate  
- **Testabilit√†**: Test indipendenti
- **Scalabilit√†**: Estensione senza rotture

## CONTROLLO VIOLAZIONI

```bash
# Deve restituire NIENTE
grep -r "SaluteOra" Modules/User/ --include="*.php"
grep -r "Patient" Modules/User/ --include="*.php"
grep -r "Studio" Modules/User/ --include="*.php"
```

## CHECKLIST OBBLIGATORIA

- [ ] Modulo √® BASE o SPECIFICO?
- [ ] Dipendenza va verso BASE?
- [ ] NON dipendo da moduli SPECIFICI?
- [ ] Modulo BASE riutilizzabile?
- [ ] Nessuna dipendenza circolare?

## ENFORCEMENT

- **Tolleranza**: ZERO
- **Correzione**: IMMEDIATA
- **Controllo**: Automatico
- **Blocco**: Pre-commit hook

## COLLEGAMENTI

- [docs/modular-architecture-enforcement.md](../../docs/modular-architecture-enforcement.md)
- [laravel/.ai/guidelines/modular-architecture-critical-rules.md](../../laravel/.ai/guidelines/modular-architecture-critical-rules.md)

---

**Violazioni compromettono l'architettura modulare del sistema.**
**Correzione richiesta entro 24 ore.**
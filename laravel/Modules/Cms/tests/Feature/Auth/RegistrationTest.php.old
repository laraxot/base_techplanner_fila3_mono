<?php

declare(strict_types=1);
namespace Modules\Cms\Tests\Feature\Auth;

use Modules\Xot\Datas\XotData;
use function Pest\Laravel\{get, post, assertDatabaseHas};

uses(\Modules\Xot\Tests\TestCase::class);

test('registration screen can be rendered', function (): void {
    $lang = app()->getLocale();
    get('/' . $lang . '/register')->assertStatus(200);
});

test('new users can register', function (): void {
    $userData = [
        'name' => 'Test User',
        'email' => 'test@example.com',
        'password' => 'password',
        'password_confirmation' => 'password',
    ];

    $lang = app()->getLocale();
    $response = post('/' . $lang . '/register', $userData);

    $response->assertRedirect(route('dashboard', absolute: false));
    
    // Verify the user was created in the database
    assertDatabaseHas('users', [
        'email' => 'test@example.com'
    ]);
});